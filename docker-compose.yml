version: '3.7'

services:
  proxy:
    image: nginx:alpine

    container_name: proxy

    ports:
      - '80:80'

    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf

    restart: 'unless-stopped'

    networks:
      - backend

  mongo:
    image: mongo:latest

    restart: always

    volumes:
      - ./.docker/data:/data/db

    ports:
      - '27017:27017'

  server:
    image: express:assignment-3

    container_name: server

    build:
      context: ./

      dockerfile: dockerfile.dev

    ports:
      - '3000:3000'

    volumes:
      - ./:/app
      - /app/node_modules

    restart: 'unless-stopped'

    networks:
      - backend

    links:
      - mongo:mongo

networks:
  backend:
    driver: bridge

volumes:
  data:
    driver: local
